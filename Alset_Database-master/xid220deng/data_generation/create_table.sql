CREATE TABLE ADDRESS (
  ADDRESS_ID NUMBER(5) GENERATED BY DEFAULT AS IDENTITY,
  GALAXY     VARCHAR(255) NOT NULL,
  PLANET     VARCHAR(255) NOT NULL,
  COUNTRY    VARCHAR(255) NOT NULL,
  STATE      VARCHAR(255) NOT NULL,
  CITY       VARCHAR(255) NOT NULL,
  STREET     VARCHAR(255) NOT NULL,

  CONSTRAINT pk_address_id PRIMARY KEY (ADDRESS_ID)
);

CREATE TABLE PAYMENT (
  PAYMENT_ID   NUMBER(5) GENERATED BY DEFAULT AS IDENTITY,
  PAYMENT_TYPE VARCHAR(16) NOT NULL,
  CARD_NUM     NUMBER(32)  NOT NULL,
  CVV          NUMBER(16)  NOT NULL,

  CONSTRAINT pk_payment_id PRIMARY KEY (PAYMENT_ID)
);

CREATE TABLE "USER" (
  USER_ID         NUMBER(5) GENERATED BY DEFAULT AS IDENTITY,
  NAME            VARCHAR(64)  NOT NULL,
  PASSWORD        VARCHAR(32)  NOT NULL,
  EMAIL           VARCHAR(255) NOT NULL,
  "TYPE"          VARCHAR(32)  NOT NULL,
  USER_ADDRESS_ID NUMBER(5)    DEFAULT NULL,
  USER_PAYMENT_ID NUMBER(5)    DEFAULT NULL,

  CONSTRAINT pk_customer_id PRIMARY KEY (USER_ID),

  CONSTRAINT fk_address_id
  FOREIGN KEY (USER_ADDRESS_ID)
  REFERENCES ADDRESS (ADDRESS_ID),

  CONSTRAINT fk_payment_id
  FOREIGN KEY (USER_PAYMENT_ID)
  REFERENCES PAYMENT (PAYMENT_ID)
);


CREATE TABLE MODEL (
  NAME               VARCHAR(16) NOT NULL,
  DESCRIPTION        VARCHAR(255) DEFAULT NULL,
  MAINTENANCE_PERIOD NUMBER(2)   NOT NULL,

  CONSTRAINT pk_model_name PRIMARY KEY (NAME)
);

CREATE TABLE SERVICE_LOCATION (
  SERVICE_LOCATION_ID NUMBER(5) GENERATED BY DEFAULT AS IDENTITY,
  NAME                VARCHAR(64) NOT NULL,
  SERVICE_ADDRESS_ID  NUMBER(5)   NOT NULL,
  MANAGER_USER_ID     NUMBER(5)   NOT NULL,

  CONSTRAINT pk_service_location_id PRIMARY KEY (SERVICE_LOCATION_ID),

  CONSTRAINT fk_location_address_id
  FOREIGN KEY (SERVICE_ADDRESS_ID)
  REFERENCES ADDRESS (ADDRESS_ID),

  CONSTRAINT fk_location_manger_id
  FOREIGN KEY (MANAGER_USER_ID)
  REFERENCES "USER" (USER_ID)
);

CREATE TABLE SERVICE_SUPPORTS (
  SERVICE_LOCATION_ID NUMBER(5)   NOT NULL,
  MODEL_NAME          VARCHAR(16) NOT NULL,

  CONSTRAINT fk_model_id
  FOREIGN KEY (MODEL_NAME)
  REFERENCES MODEL (NAME),

  CONSTRAINT fk_service_location_id
  FOREIGN KEY (SERVICE_LOCATION_ID)
  REFERENCES SERVICE_LOCATION (SERVICE_LOCATION_ID)
);

CREATE TABLE SKU (
  SKU_ID       NUMBER(5) GENERATED BY DEFAULT AS IDENTITY,
  MODEL_NAME   VARCHAR(16)    NOT NULL,
  NAME         VARCHAR(64)    NOT NULL,
  PRICE        DECIMAL(10, 2) NOT NULL,
  RESELL_PRICE DECIMAL(10, 2) NOT NULL,
  REPAIR_PRICE DECIMAL(10, 2) NOT NULL,

  CONSTRAINT pk_sku_id PRIMARY KEY (SKU_ID),

  CONSTRAINT fk_sku_model_name
  FOREIGN KEY (MODEL_NAME)
  REFERENCES MODEL (NAME)
);

CREATE TABLE VEHICLE_CONFIG (
  CONFIG      VARCHAR(64)  NOT NULL,
  DESCRIPTION VARCHAR(255) NOT NULL,

  CONSTRAINT pk_vehicle_config PRIMARY KEY (CONFIG)
);

CREATE TABLE SKU_INCLUDES (
  SKU_ID NUMBER(5)   NOT NULL,
  CONFIG VARCHAR(64) NOT NULL,

  CONSTRAINT fk_sku_sku_id
  FOREIGN KEY (SKU_ID)
  REFERENCES SKU (SKU_ID),

  CONSTRAINT fk_sku_vehicle_config
  FOREIGN KEY (CONFIG)
  REFERENCES VEHICLE_CONFIG (CONFIG)
);

CREATE TABLE VEHICLE (
  VEHICLE_ID   NUMBER(12) GENERATED BY DEFAULT AS IDENTITY,
  SKU_ID       NUMBER(5)      NOT NULL,
  STATUS       VARCHAR(16)    NOT NULL,
  USED         NUMBER(1) DEFAULT '0',

  CONSTRAINT pk_vehicle_id PRIMARY KEY (VEHICLE_ID),

  CONSTRAINT fk_sku_id
  FOREIGN KEY (SKU_ID)
  REFERENCES SKU (SKU_ID)
);

CREATE TABLE VEHICLE_SHOWS (
  VEHICLE_ID  NUMBER(12) NOT NULL,
  LOCATION_ID NUMBER(5)  NOT NULL,

  CONSTRAINT fk_showroom_vehicle_id
  FOREIGN KEY (VEHICLE_ID)
  REFERENCES VEHICLE (VEHICLE_ID),

  CONSTRAINT fk_showroom_location_id
  FOREIGN KEY (LOCATION_ID)
  REFERENCES SERVICE_LOCATION (SERVICE_LOCATION_ID)
);


CREATE TABLE VEHICLE_STOCK (
  VEHICLE_ID  NUMBER(12) NOT NULL,
  LOCATION_ID NUMBER(5),

  CONSTRAINT fk_stock_vehicle_id
  FOREIGN KEY (VEHICLE_ID)
  REFERENCES VEHICLE (VEHICLE_ID),

  CONSTRAINT fk_stock_location_id
  FOREIGN KEY (LOCATION_ID)
  REFERENCES SERVICE_LOCATION (SERVICE_LOCATION_ID)
);

CREATE TABLE SALE (
  SALE_ID            NUMBER(16) GENERATED BY DEFAULT AS IDENTITY,
  BUYER_ID           NUMBER(5)      NOT NULL,
  VEHICLE_ID         NUMBER(12)     NOT NULL,
  DISCOUNT           NUMBER(3) DEFAULT 100,
  FACT_PRICE         DECIMAL(20, 2) NOT NULL,
  STATUS             VARCHAR(16)    NOT NULL,
  SALE_DATE          DATE           NOT NULL,
  PICKUP_LOCATION_ID NUMBER(5)      NOT NULL,
  PICKUP_DATE        DATE      DEFAULT NULL,

  CONSTRAINT pk_sale_id PRIMARY KEY (SALE_ID),

  CONSTRAINT fk_buyer_id
  FOREIGN KEY (BUYER_ID)
  REFERENCES "USER" (USER_ID),

  CONSTRAINT fk_vehicle_id
  FOREIGN KEY (VEHICLE_ID)
  REFERENCES VEHICLE (VEHICLE_ID),

  CONSTRAINT fk_pickup_location_id
  FOREIGN KEY (PICKUP_LOCATION_ID)
  REFERENCES SERVICE_LOCATION (SERVICE_LOCATION_ID)
);

CREATE TABLE REPAIR (
  REPAIR_ID           NUMBER(16) GENERATED BY DEFAULT AS IDENTITY,
  VEHICLE_ID          NUMBER(12)     NOT NULL,
  SERVICE_LOCATION_ID NUMBER(5)      NOT NULL,
  REPAIR_DATE         DATE           NOT NULL,
  TOTAL_COST          DECIMAL(20, 2) NOT NULL,

  CONSTRAINT pk_repair_id PRIMARY KEY (REPAIR_ID),

  CONSTRAINT fk_repair_vehicle_id
  FOREIGN KEY (VEHICLE_ID)
  REFERENCES VEHICLE (VEHICLE_ID),

  CONSTRAINT fk_repair_service_location_id
  FOREIGN KEY (SERVICE_LOCATION_ID)
  REFERENCES SERVICE_LOCATION (SERVICE_LOCATION_ID)
);
